# 窗口缩小时界面组件挤压问题 - 解决方案

## 问题分析

应用窗口缩小时，界面上的组件会被挤压，导致用户体验下降。这是由于：
1. 没有设置最小窗口尺寸
2. 布局缺少弹性容器和滚动处理
3. 没有自适应窗口大小的机制

## Electron 应用的通用解决方案

根据业界最佳实践，Electron 应用通常通过以下方式解决窗口缩小问题：

### 1. 设置最小窗口尺寸
防止窗口缩得过小，保证 UI 的最小可用空间。

### 2. 响应式布局设计
使用 CSS Flexbox/Grid 和媒体查询，确保在不同窗口尺寸下都能正常显示。

### 3. 滚动容器管理
确保内容区域可以滚动，而不是被挤压或隐藏。

### 4. 自适应组件调整
根据窗口大小自动调整组件尺寸或隐藏某些元素（如自动折叠侧边栏）。

### 5. 窗口状态持久化
记住用户的窗口尺寸偏好（未实现，可作为后续优化）。

## 实施的解决方案

### 1. 主进程窗口配置（main.ts）

```typescript
const mainWindow = new BrowserWindow({
  width: 1200,        // 增大默认宽度（原：800）
  height: 800,        // 增大默认高度（原：600）
  minWidth: 900,      // 新增：最小宽度限制
  minHeight: 600,     // 新增：最小高度限制
  webPreferences: {
    preload: path.join(__dirname, 'preload.js'),
  },
});
```

**优化点：**
- 提高默认窗口尺寸，提供更好的初始体验
- 设置最小尺寸限制，防止窗口缩得太小导致 UI 不可用

### 2. 主布局优化（MainLayout.tsx & MainLayout.css）

**TypeScript 改进：**
- 添加窗口大小监听，在窗口宽度 < 1000px 时自动折叠侧边栏
- 区分用户手动折叠和自动折叠，窗口恢复时智能展开
- 使用 `useEffect` 和 `resize` 事件实现响应式行为

**CSS 改进：**
```css
.main-layout {
  min-width: 900px;  /* 防止布局被压缩到不可用 */
}

.main-sidebar {
  flex-shrink: 0;    /* 防止侧边栏被压缩 */
  min-width: 80px;   /* 确保折叠状态下的最小宽度 */
}

.main-content-layout {
  flex: 1;
  min-width: 0;      /* 允许弹性收缩但不会溢出 */
}

.main-content {
  overflow: auto;    /* 改为 auto，允许在需要时滚动 */
}
```

### 3. 内容区域优化（ContentArea.css）

```css
.content-area {
  display: flex;
  flex-direction: column;
}

.content-wrapper {
  flex: 1;
  min-height: 0;     /* 重要：允许弹性项目正确滚动 */
}

/* 响应式内边距 */
@media (max-width: 1200px) {
  .content-wrapper { padding: var(--spacing-lg); }
}

@media (max-width: 768px) {
  .content-wrapper { padding: var(--spacing-md); }
}
```

### 4. 页面级别优化

对所有页面组件进行了统一的布局优化：

#### ChatPage（知识问答）
- 使用 Flexbox 布局，确保左右面板合理分配空间
- 左侧面板设置 `min-width: 200px`，确保有最小宽度
- 右侧聊天区域使用 `flex: 1` 和 `min-width: 0`，允许弹性收缩
- 添加响应式设计，小屏幕时改为垂直布局

#### SettingsPage（设置页面）
- 主容器使用 Flexbox 布局
- 左侧导航栏添加 `overflow-y: auto`，支持滚动
- 右侧内容区域添加 `overflow-y: auto`，支持滚动
- 响应式设计：中等屏幕时改为垂直布局

#### NotesPage（笔记页面）
- 主容器添加 `display: flex` 和 `flex-direction: column`
- 内容区域使用 `flex: 1`，自动填充剩余空间
- 支持整体页面滚动

#### HomePage、LibraryPage、AnalyticsPage、KnowledgeGraphPage
- 统一添加 Flexbox 布局
- 确保内容可以正确滚动
- 设置 `height: 100%` 和 `min-height: 0`，防止内容溢出

## 关键 CSS 技术点

### 1. Flexbox + min-height: 0
```css
.container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.content {
  flex: 1;
  min-height: 0;  /* 关键：允许子元素正确滚动 */
  overflow-y: auto;
}
```

这是解决 Flexbox 中滚动问题的关键技术。没有 `min-height: 0`，Flexbox 子项会扩展以适应内容，导致无法滚动。

### 2. flex-shrink 控制
```css
.sidebar {
  flex-shrink: 0;  /* 不允许收缩 */
  min-width: 80px;
}

.main-content {
  flex: 1;
  min-width: 0;    /* 允许收缩但不溢出 */
}
```

精确控制哪些元素可以收缩，确保关键 UI 组件（如侧边栏）不会被挤压变形。

### 3. 响应式设计
```css
@media (max-width: 1200px) {
  /* 中等屏幕优化 */
}

@media (max-width: 768px) {
  /* 小屏幕优化 */
}
```

使用媒体查询在不同屏幕尺寸下调整布局和样式。

## 测试建议

### 1. 窗口尺寸测试
- [ ] 测试窗口缩小到最小尺寸（900x600）
- [ ] 测试窗口从小到大的过渡
- [ ] 验证侧边栏自动折叠/展开功能

### 2. 页面滚动测试
- [ ] 测试所有页面的滚动功能
- [ ] 验证内容不会被截断或隐藏
- [ ] 检查滚动条样式是否一致

### 3. 响应式布局测试
- [ ] 测试在不同窗口宽度下的布局表现
- [ ] 验证 ChatPage 的左右布局在小窗口时的行为
- [ ] 检查 SettingsPage 在不同尺寸下的显示

### 4. 跨平台测试
- [ ] macOS
- [ ] Windows
- [ ] Linux

## 未来改进建议

### 1. 窗口状态持久化
使用 `electron-store` 或类似库保存和恢复用户的窗口尺寸偏好：
```typescript
// 保存窗口状态
mainWindow.on('resize', () => {
  const bounds = mainWindow.getBounds();
  store.set('windowBounds', bounds);
});

// 恢复窗口状态
const savedBounds = store.get('windowBounds');
if (savedBounds) {
  mainWindow.setBounds(savedBounds);
}
```

### 2. 更精细的响应式断点
根据实际使用情况，可能需要添加更多的响应式断点：
- 超小屏幕：< 576px
- 小屏幕：576px - 768px
- 中等屏幕：768px - 992px
- 大屏幕：992px - 1200px
- 超大屏幕：> 1200px

### 3. 侧边栏宽度调整
添加可拖拽调整侧边栏宽度的功能，提供更好的用户体验。

### 4. 组件级别的响应式处理
某些复杂组件（如图表、表格）可能需要更细粒度的响应式处理。

## 总结

通过以上优化，应用现在能够：
✅ 防止窗口缩得过小
✅ 在小窗口下自动折叠侧边栏
✅ 确保所有内容都可以通过滚动访问
✅ 提供流畅的响应式布局体验
✅ 保持一致的视觉效果

所有改动都遵循了现代 Web 应用的最佳实践，使用了成熟的 CSS 技术，代码清晰易维护。

