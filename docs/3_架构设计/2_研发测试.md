# è¶£çŸ¥æ¡Œé¢ç‰ˆ - ç ”å‘æµ‹è¯•

<div align="center">
  <h1>ğŸ§ª è¶£çŸ¥æ¡Œé¢ç‰ˆç ”å‘æµ‹è¯•</h1>
  <p>å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ä¸è´¨é‡ä¿éšœä½“ç³»</p>
</div>

---

## ğŸ“– ç›®å½•

1. [æµ‹è¯•ç­–ç•¥](#1-æµ‹è¯•ç­–ç•¥)
2. [æµ‹è¯•æ¶æ„](#2-æµ‹è¯•æ¶æ„)
3. [å•å…ƒæµ‹è¯•](#3-å•å…ƒæµ‹è¯•)
4. [é›†æˆæµ‹è¯•](#4-é›†æˆæµ‹è¯•)
5. [ç«¯åˆ°ç«¯æµ‹è¯•](#5-ç«¯åˆ°ç«¯æµ‹è¯•)
6. [æ€§èƒ½æµ‹è¯•](#6-æ€§èƒ½æµ‹è¯•)
7. [å¼€å‘å·¥å…·é“¾](#7-å¼€å‘å·¥å…·é“¾)
8. [è´¨é‡ä¿éšœ](#8-è´¨é‡ä¿éšœ)

---

## 1. æµ‹è¯•ç­–ç•¥

### 1.1 æµ‹è¯•é‡‘å­—å¡”

```mermaid
graph TB
    A[æµ‹è¯•é‡‘å­—å¡”] --> B[E2Eæµ‹è¯• 10%]
    A --> C[é›†æˆæµ‹è¯• 30%]
    A --> D[å•å…ƒæµ‹è¯• 60%]
    
    B --> B1[ç”¨æˆ·æµç¨‹æµ‹è¯•]
    B --> B2[è·¨å¹³å°æµ‹è¯•]
    
    C --> C1[IPCé€šä¿¡æµ‹è¯•]
    C --> C2[æ•°æ®åº“é›†æˆ]
    C --> C3[APIé›†æˆ]
    
    D --> D1[ç»„ä»¶æµ‹è¯•]
    D --> D2[æœåŠ¡æµ‹è¯•]
    D --> D3[å·¥å…·å‡½æ•°æµ‹è¯•]
```

### 1.2 æµ‹è¯•åŸåˆ™

#### æµ‹è¯•ä¼˜å…ˆçº§

1. **P0 - å…³é”®è·¯å¾„**: æ ¸å¿ƒä¸šåŠ¡æµç¨‹å¿…é¡»æµ‹è¯•
2. **P1 - é‡è¦åŠŸèƒ½**: ä¸»è¦åŠŸèƒ½éœ€è¦æµ‹è¯•
3. **P2 - è¾…åŠ©åŠŸèƒ½**: éå…³é”®åŠŸèƒ½é€‰æ‹©æ€§æµ‹è¯•

#### æµ‹è¯•ç±»å‹åˆ†é…

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | æ‰§è¡Œé¢‘ç‡ | æ‰§è¡Œç¯å¢ƒ |
|----------|------------|----------|----------|
| å•å…ƒæµ‹è¯• | 80% | æ¯æ¬¡æäº¤ | æœ¬åœ°+CI |
| é›†æˆæµ‹è¯• | 60% | æ¯æ—¥æ„å»º | CI |
| E2Eæµ‹è¯• | æ ¸å¿ƒæµç¨‹ | å‘å¸ƒå‰ | CI+æ‰‹åŠ¨ |
| æ€§èƒ½æµ‹è¯• | å…³é”®æŒ‡æ ‡ | æ¯å‘¨ | ä¸“ç”¨ç¯å¢ƒ |

#### æµ‹è¯•è´¨é‡æ ‡å‡†

- **ä»£ç è¦†ç›–ç‡**: æ€»ä½“ > 80%ï¼Œæ ¸å¿ƒæ¨¡å— > 90%
- **æµ‹è¯•é€šè¿‡ç‡**: > 99%
- **æ‰§è¡Œæ—¶é—´**: å•å…ƒæµ‹è¯• < 5åˆ†é’Ÿï¼Œå®Œæ•´æµ‹è¯• < 30åˆ†é’Ÿ
- **ç»´æŠ¤æˆæœ¬**: æµ‹è¯•ä»£ç ä¸ä¸šåŠ¡ä»£ç æ¯”ä¾‹ < 1:2

---

## 2. æµ‹è¯•æ¶æ„

### 2.1 æµ‹è¯•æŠ€æœ¯æ ˆ

#### æµ‹è¯•æ¡†æ¶

```typescript
{
  "å•å…ƒæµ‹è¯•": "Jest 29.7.0",
  "ç»„ä»¶æµ‹è¯•": "@testing-library/react 14.0.0",
  "E2Eæµ‹è¯•": "Playwright 1.40.0",
  "Mockå·¥å…·": "jest-mock",
  "è¦†ç›–ç‡": "jest-coverage"
}
```

#### æµ‹è¯•å·¥å…·

- **Jest**: å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ¡†æ¶
- **Testing Library**: Reactç»„ä»¶æµ‹è¯•
- **Playwright**: ç«¯åˆ°ç«¯æµ‹è¯•
- **MSW**: API MockæœåŠ¡
- **jest-electron**: Electronç¯å¢ƒæµ‹è¯•

### 2.2 æµ‹è¯•ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ __tests__/                    # æµ‹è¯•æ ¹ç›®å½•
â”‚   â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ components/         # ç»„ä»¶æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.test.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatArea.test.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.test.tsx
â”‚   â”‚   â”œâ”€â”€ services/           # æœåŠ¡æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ StorageService.test.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ AIService.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ SearchService.test.ts
â”‚   â”‚   â”œâ”€â”€ hooks/              # Hooksæµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ useStorage.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ useModelConfig.test.ts
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”‚       â”œâ”€â”€ apiTest.test.ts
â”‚   â”‚       â””â”€â”€ validators.test.ts
â”‚   â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ipc/                # IPCé€šä¿¡æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“æµ‹è¯•
â”‚   â”‚   â””â”€â”€ workflow/           # ä¸šåŠ¡æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ e2e/                     # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ chat.spec.ts        # èŠå¤©åŠŸèƒ½æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ document.spec.ts    # æ–‡æ¡£ç®¡ç†æµ‹è¯•
â”‚   â”‚   â””â”€â”€ settings.spec.ts    # è®¾ç½®åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ performance/             # æ€§èƒ½æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ startup.test.ts     # å¯åŠ¨æ€§èƒ½
â”‚   â”‚   â”œâ”€â”€ rendering.test.ts   # æ¸²æŸ“æ€§èƒ½
â”‚   â”‚   â””â”€â”€ memory.test.ts      # å†…å­˜æµ‹è¯•
â”‚   â”œâ”€â”€ fixtures/                # æµ‹è¯•æ•°æ®
â”‚   â”‚   â”œâ”€â”€ documents/
â”‚   â”‚   â”œâ”€â”€ mocks/
â”‚   â”‚   â””â”€â”€ data.json
â”‚   â”œâ”€â”€ helpers/                 # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ setup.ts
â”‚   â”‚   â”œâ”€â”€ mocks.ts
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â””â”€â”€ coverage/                # è¦†ç›–ç‡æŠ¥å‘Š
â””â”€â”€ playwright.config.ts         # Playwrighté…ç½®
```

### 2.3 æµ‹è¯•é…ç½®

#### Jesté…ç½®

```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  
  // æµ‹è¯•åŒ¹é…
  testMatch: [
    '**/__tests__/**/*.test.ts',
    '**/__tests__/**/*.test.tsx'
  ],
  
  // è¦†ç›–ç‡é…ç½®
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/__tests__/**',
    '!src/main/main.ts'
  ],
  
  // è¦†ç›–ç‡é˜ˆå€¼
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  },
  
  // è®¾ç½®æ–‡ä»¶
  setupFilesAfterEnv: ['<rootDir>/src/__tests__/helpers/setup.ts'],
  
  // æ¨¡å—æ˜ å°„
  moduleNameMapper: {
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
    '\\.(jpg|jpeg|png|gif|svg)$': '<rootDir>/src/__tests__/helpers/fileMock.js'
  },
  
  // è½¬æ¢é…ç½®
  transform: {
    '^.+\\.tsx?$': ['ts-jest', {
      tsconfig: 'tsconfig.json'
    }]
  }
};
```

#### Playwrighté…ç½®

```typescript
// playwright.config.ts
import { PlaywrightTestConfig } from '@playwright/test';

const config: PlaywrightTestConfig = {
  testDir: './src/__tests__/e2e',
  
  // è¶…æ—¶é…ç½®
  timeout: 30000,
  
  // é‡è¯•é…ç½®
  retries: 2,
  
  // å¹¶è¡Œé…ç½®
  workers: 4,
  
  // æŠ¥å‘Šé…ç½®
  reporter: [
    ['html', { outputFolder: 'test-results/html' }],
    ['junit', { outputFile: 'test-results/junit.xml' }]
  ],
  
  // æµè§ˆå™¨é…ç½®
  use: {
    headless: true,
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    trace: 'on-first-retry'
  },
  
  // é¡¹ç›®é…ç½®
  projects: [
    {
      name: 'Electron',
      use: {
        browserName: 'chromium',
        launchOptions: {
          executablePath: require('electron')
        }
      }
    }
  ]
};

export default config;
```

---

## 3. å•å…ƒæµ‹è¯•

### 3.1 ç»„ä»¶æµ‹è¯•

#### åŸºç¡€ç»„ä»¶æµ‹è¯•

```typescript
// __tests__/unit/components/Sidebar.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Sidebar } from '@/components/Sidebar';

describe('Sidebar Component', () => {
  const mockProps = {
    collapsed: false,
    selectedTab: 'home',
    onTabChange: jest.fn(),
    onToggle: jest.fn()
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('Rendering', () => {
    test('renders all navigation items', () => {
      render(<Sidebar {...mockProps} />);
      
      expect(screen.getByText('æˆ‘çš„é¦–é¡µ')).toBeInTheDocument();
      expect(screen.getByText('çŸ¥è¯†é—®ç­”')).toBeInTheDocument();
      expect(screen.getByText('çŸ¥è¯†å›¾è°±')).toBeInTheDocument();
      expect(screen.getByText('çŸ¥è¯†åº“')).toBeInTheDocument();
      expect(screen.getByText('ç¬”è®°')).toBeInTheDocument();
      expect(screen.getByText('å­¦ä¹ æ•°æ®')).toBeInTheDocument();
      expect(screen.getByText('è®¾ç½®')).toBeInTheDocument();
    });

    test('applies active class to selected tab', () => {
      render(<Sidebar {...mockProps} selectedTab="qna" />);
      
      const qnaButton = screen.getByText('çŸ¥è¯†é—®ç­”').closest('button');
      expect(qnaButton).toHaveClass('active');
    });

    test('renders in collapsed state', () => {
      render(<Sidebar {...mockProps} collapsed={true} />);
      
      const sidebar = screen.getByRole('navigation');
      expect(sidebar).toHaveClass('collapsed');
    });
  });

  describe('Interactions', () => {
    test('handles tab selection', async () => {
      render(<Sidebar {...mockProps} />);
      
      const qnaButton = screen.getByText('çŸ¥è¯†é—®ç­”');
      fireEvent.click(qnaButton);
      
      expect(mockProps.onTabChange).toHaveBeenCalledWith('qna');
      expect(mockProps.onTabChange).toHaveBeenCalledTimes(1);
    });

    test('handles toggle button click', async () => {
      render(<Sidebar {...mockProps} />);
      
      const toggleButton = screen.getByRole('button', { name: /fold/i });
      fireEvent.click(toggleButton);
      
      expect(mockProps.onToggle).toHaveBeenCalled();
    });
  });

  describe('Accessibility', () => {
    test('has proper ARIA attributes', () => {
      render(<Sidebar {...mockProps} />);
      
      const nav = screen.getByRole('navigation');
      expect(nav).toHaveAttribute('aria-label');
    });

    test('supports keyboard navigation', () => {
      render(<Sidebar {...mockProps} />);
      
      const firstButton = screen.getByText('æˆ‘çš„é¦–é¡µ');
      firstButton.focus();
      
      expect(firstButton).toHaveFocus();
    });
  });
});
```

#### å¤æ‚ç»„ä»¶æµ‹è¯•

```typescript
// __tests__/unit/components/ChatArea.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { ChatArea } from '@/components/chat/components/ChatArea';
import { ChatProvider } from '@/contexts/ChatContext';
import * as aiService from '@/services/ai/ChatCompletion';

// Mock AIæœåŠ¡
jest.mock('@/services/ai/ChatCompletion');

describe('ChatArea Component', () => {
  const mockChatCompletion = aiService.chatCompletion as jest.MockedFunction<
    typeof aiService.chatCompletion
  >;

  beforeEach(() => {
    jest.clearAllMocks();
  });

  const renderWithProvider = (component: React.ReactElement) => {
    return render(
      <ChatProvider>
        {component}
      </ChatProvider>
    );
  };

  describe('Message Display', () => {
    test('displays chat messages', () => {
      renderWithProvider(<ChatArea />);
      
      // éªŒè¯æ¶ˆæ¯åˆ—è¡¨æ¸²æŸ“
      const messageList = screen.getByRole('list');
      expect(messageList).toBeInTheDocument();
    });

    test('displays user and assistant messages differently', async () => {
      mockChatCompletion.mockResolvedValueOnce({
        content: 'AIå›å¤å†…å®¹',
        finishReason: 'stop',
        usage: { promptTokens: 10, completionTokens: 20, totalTokens: 30 }
      });

      renderWithProvider(<ChatArea />);
      
      // å‘é€æ¶ˆæ¯
      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i);
      const sendButton = screen.getByRole('button', { name: /å‘é€/i });
      
      fireEvent.change(input, { target: { value: 'æµ‹è¯•é—®é¢˜' } });
      fireEvent.click(sendButton);
      
      // éªŒè¯ç”¨æˆ·æ¶ˆæ¯
      await waitFor(() => {
        expect(screen.getByText('æµ‹è¯•é—®é¢˜')).toBeInTheDocument();
      });
      
      // éªŒè¯AIå›å¤
      await waitFor(() => {
        expect(screen.getByText('AIå›å¤å†…å®¹')).toBeInTheDocument();
      });
    });
  });

  describe('Message Sending', () => {
    test('sends message on button click', async () => {
      mockChatCompletion.mockResolvedValueOnce({
        content: 'å›å¤',
        finishReason: 'stop',
        usage: { promptTokens: 10, completionTokens: 20, totalTokens: 30 }
      });

      renderWithProvider(<ChatArea />);
      
      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i);
      const sendButton = screen.getByRole('button', { name: /å‘é€/i });
      
      fireEvent.change(input, { target: { value: 'ä½ å¥½' } });
      fireEvent.click(sendButton);
      
      await waitFor(() => {
        expect(mockChatCompletion).toHaveBeenCalled();
      });
    });

    test('sends message on Enter key', async () => {
      renderWithProvider(<ChatArea />);
      
      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i);
      
      fireEvent.change(input, { target: { value: 'ä½ å¥½' } });
      fireEvent.keyPress(input, { key: 'Enter', code: 13, charCode: 13 });
      
      await waitFor(() => {
        expect(mockChatCompletion).toHaveBeenCalled();
      });
    });

    test('clears input after sending', async () => {
      renderWithProvider(<ChatArea />);
      
      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i) as HTMLInputElement;
      const sendButton = screen.getByRole('button', { name: /å‘é€/i });
      
      fireEvent.change(input, { target: { value: 'ä½ å¥½' } });
      fireEvent.click(sendButton);
      
      await waitFor(() => {
        expect(input.value).toBe('');
      });
    });
  });

  describe('Error Handling', () => {
    test('displays error message on API failure', async () => {
      mockChatCompletion.mockRejectedValueOnce(new Error('APIé”™è¯¯'));

      renderWithProvider(<ChatArea />);
      
      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i);
      const sendButton = screen.getByRole('button', { name: /å‘é€/i });
      
      fireEvent.change(input, { target: { value: 'ä½ å¥½' } });
      fireEvent.click(sendButton);
      
      await waitFor(() => {
        expect(screen.getByText(/é”™è¯¯/i)).toBeInTheDocument();
      });
    });
  });
});
```

### 3.2 æœåŠ¡æµ‹è¯•

#### å­˜å‚¨æœåŠ¡æµ‹è¯•

```typescript
// __tests__/unit/services/StorageService.test.ts
import { StorageService } from '@/services/StorageService';

describe('StorageService', () => {
  let storageService: StorageService;
  
  beforeEach(() => {
    storageService = new StorageService();
    // æ¸…ç†å­˜å‚¨
    storageService.clear();
  });

  describe('Basic Operations', () => {
    test('stores and retrieves data', () => {
      const testData = { name: 'test', value: 123 };
      
      storageService.set('testKey', testData);
      const retrieved = storageService.get('testKey');
      
      expect(retrieved).toEqual(testData);
    });

    test('returns undefined for non-existent key', () => {
      const result = storageService.get('nonExistentKey');
      
      expect(result).toBeUndefined();
    });

    test('deletes data', () => {
      storageService.set('testKey', 'value');
      storageService.delete('testKey');
      
      const result = storageService.get('testKey');
      expect(result).toBeUndefined();
    });

    test('checks key existence', () => {
      storageService.set('testKey', 'value');
      
      expect(storageService.has('testKey')).toBe(true);
      expect(storageService.has('nonExistentKey')).toBe(false);
    });

    test('clears all data', () => {
      storageService.set('key1', 'value1');
      storageService.set('key2', 'value2');
      
      storageService.clear();
      
      expect(storageService.has('key1')).toBe(false);
      expect(storageService.has('key2')).toBe(false);
    });
  });

  describe('Complex Data Types', () => {
    test('handles arrays', () => {
      const testArray = [1, 2, 3, 4, 5];
      
      storageService.set('arrayKey', testArray);
      const retrieved = storageService.get('arrayKey');
      
      expect(retrieved).toEqual(testArray);
    });

    test('handles nested objects', () => {
      const nestedObject = {
        level1: {
          level2: {
            value: 'deep'
          }
        }
      };
      
      storageService.set('nestedKey', nestedObject);
      const retrieved = storageService.get('nestedKey');
      
      expect(retrieved).toEqual(nestedObject);
    });
  });
});
```

#### AIæœåŠ¡æµ‹è¯•

```typescript
// __tests__/unit/services/ai/ChatCompletion.test.ts
import { chatCompletion } from '@/services/ai/ChatCompletion';
import * as urlUtils from '@/services/ai/UrlUtils';
import * as requestBuilder from '@/services/ai/RequestBuilder';

// Mockä¾èµ–
jest.mock('@/services/ai/UrlUtils');
jest.mock('@/services/ai/RequestBuilder');

global.fetch = jest.fn();

describe('ChatCompletion Service', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  test('sends chat completion request successfully', async () => {
    const mockResponse = {
      choices: [
        {
          message: {
            role: 'assistant',
            content: 'æµ‹è¯•å›å¤'
          },
          finish_reason: 'stop'
        }
      ],
      usage: {
        prompt_tokens: 10,
        completion_tokens: 20,
        total_tokens: 30
      }
    };

    (global.fetch as jest.Mock).mockResolvedValueOnce({
      ok: true,
      json: async () => mockResponse
    });

    const result = await chatCompletion({
      messages: [{ role: 'user', content: 'ä½ å¥½' }],
      apiUrl: 'https://api.openai.com/v1',
      apiKey: 'test-key',
      model: 'gpt-3.5-turbo'
    });

    expect(result.content).toBe('æµ‹è¯•å›å¤');
    expect(result.finishReason).toBe('stop');
    expect(result.usage?.totalTokens).toBe(30);
  });

  test('handles API errors', async () => {
    (global.fetch as jest.Mock).mockResolvedValueOnce({
      ok: false,
      status: 401,
      json: async () => ({ error: { message: 'æ— æ•ˆçš„APIå¯†é’¥' } })
    });

    await expect(
      chatCompletion({
        messages: [{ role: 'user', content: 'ä½ å¥½' }],
        apiUrl: 'https://api.openai.com/v1',
        apiKey: 'invalid-key',
        model: 'gpt-3.5-turbo'
      })
    ).rejects.toThrow();
  });

  test('handles network errors', async () => {
    (global.fetch as jest.Mock).mockRejectedValueOnce(
      new Error('Network error')
    );

    await expect(
      chatCompletion({
        messages: [{ role: 'user', content: 'ä½ å¥½' }],
        apiUrl: 'https://api.openai.com/v1',
        apiKey: 'test-key',
        model: 'gpt-3.5-turbo'
      })
    ).rejects.toThrow('Network error');
  });
});
```

### 3.3 Hooksæµ‹è¯•

```typescript
// __tests__/unit/hooks/useStorage.test.ts
import { renderHook, act } from '@testing-library/react';
import { useStorage } from '@/hooks/UseStorage';

describe('useStorage Hook', () => {
  beforeEach(() => {
    // æ¸…ç†electron API mock
    (window as any).electronAPI = {
      storage: {
        get: jest.fn(),
        set: jest.fn(),
        delete: jest.fn()
      }
    };
  });

  test('initializes with default value', () => {
    const { result } = renderHook(() => 
      useStorage('testKey', 'defaultValue')
    );

    expect(result.current[0]).toBe('defaultValue');
  });

  test('updates value', async () => {
    const mockSet = jest.fn().mockResolvedValue(undefined);
    (window as any).electronAPI.storage.set = mockSet;

    const { result } = renderHook(() => 
      useStorage('testKey', 'initial')
    );

    await act(async () => {
      await result.current[1]('newValue');
    });

    expect(mockSet).toHaveBeenCalledWith('testKey', 'newValue');
  });

  test('handles storage errors', async () => {
    const mockSet = jest.fn().mockRejectedValue(new Error('Storage error'));
    (window as any).electronAPI.storage.set = mockSet;

    const { result } = renderHook(() => 
      useStorage('testKey', 'initial')
    );

    await expect(
      act(async () => {
        await result.current[1]('newValue');
      })
    ).rejects.toThrow('Storage error');
  });
});
```

---

## 4. é›†æˆæµ‹è¯•

### 4.1 IPCé€šä¿¡æµ‹è¯•

```typescript
// __tests__/integration/ipc/storage.test.ts
import { ipcMain, ipcRenderer } from 'electron';
import { StorageHandlers } from '@/ipc/StorageHandlers';

describe('Storage IPC Integration', () => {
  let storageHandlers: StorageHandlers;

  beforeAll(() => {
    storageHandlers = new StorageHandlers();
    storageHandlers.registerHandlers();
  });

  test('get storage value via IPC', async () => {
    const testData = { value: 'test' };
    
    // æ¨¡æ‹Ÿæ¸²æŸ“è¿›ç¨‹è°ƒç”¨
    const result = await ipcRenderer.invoke('storage:get', 'testKey');
    
    expect(result).toBeDefined();
  });

  test('set storage value via IPC', async () => {
    const testData = { value: 'test' };
    
    await ipcRenderer.invoke('storage:set', 'testKey', testData);
    const result = await ipcRenderer.invoke('storage:get', 'testKey');
    
    expect(result).toEqual(testData);
  });

  test('delete storage value via IPC', async () => {
    await ipcRenderer.invoke('storage:set', 'testKey', 'value');
    await ipcRenderer.invoke('storage:delete', 'testKey');
    
    const result = await ipcRenderer.invoke('storage:get', 'testKey');
    expect(result).toBeUndefined();
  });
});
```

### 4.2 æ•°æ®åº“é›†æˆæµ‹è¯•

```typescript
// __tests__/integration/database/documents.test.ts
import { DatabaseService } from '@/main/services/DatabaseService';

describe('Document Database Integration', () => {
  let db: DatabaseService;

  beforeAll(async () => {
    db = new DatabaseService(':memory:'); // ä½¿ç”¨å†…å­˜æ•°æ®åº“
    await db.initialize();
  });

  afterAll(async () => {
    await db.close();
  });

  describe('Document CRUD', () => {
    test('creates document', async () => {
      const document = await db.createDocument({
        title: 'æµ‹è¯•æ–‡æ¡£',
        content: 'æµ‹è¯•å†…å®¹',
        tags: ['test']
      });

      expect(document.id).toBeDefined();
      expect(document.title).toBe('æµ‹è¯•æ–‡æ¡£');
    });

    test('retrieves document by id', async () => {
      const created = await db.createDocument({
        title: 'æµ‹è¯•æ–‡æ¡£',
        content: 'æµ‹è¯•å†…å®¹'
      });

      const retrieved = await db.getDocument(created.id);

      expect(retrieved).toEqual(created);
    });

    test('updates document', async () => {
      const created = await db.createDocument({
        title: 'åŸæ ‡é¢˜',
        content: 'åŸå†…å®¹'
      });

      await db.updateDocument(created.id, {
        title: 'æ–°æ ‡é¢˜'
      });

      const updated = await db.getDocument(created.id);
      expect(updated.title).toBe('æ–°æ ‡é¢˜');
      expect(updated.content).toBe('åŸå†…å®¹');
    });

    test('deletes document', async () => {
      const created = await db.createDocument({
        title: 'å¾…åˆ é™¤æ–‡æ¡£',
        content: 'å†…å®¹'
      });

      await db.deleteDocument(created.id);

      const retrieved = await db.getDocument(created.id);
      expect(retrieved).toBeNull();
    });
  });

  describe('Document Query', () => {
    beforeEach(async () => {
      // åˆ›å»ºæµ‹è¯•æ•°æ®
      await db.createDocument({ title: 'æ–‡æ¡£1', tags: ['tag1'] });
      await db.createDocument({ title: 'æ–‡æ¡£2', tags: ['tag2'] });
      await db.createDocument({ title: 'æ–‡æ¡£3', tags: ['tag1', 'tag2'] });
    });

    test('lists all documents', async () => {
      const documents = await db.listDocuments();

      expect(documents.length).toBeGreaterThanOrEqual(3);
    });

    test('filters documents by tag', async () => {
      const documents = await db.listDocuments({ tags: ['tag1'] });

      expect(documents.length).toBe(2);
      expect(documents.every(doc => doc.tags.includes('tag1'))).toBe(true);
    });

    test('searches documents', async () => {
      const results = await db.searchDocuments('æ–‡æ¡£1');

      expect(results.length).toBeGreaterThan(0);
      expect(results[0].title).toContain('æ–‡æ¡£1');
    });
  });
});
```

---

## 5. ç«¯åˆ°ç«¯æµ‹è¯•

### 5.1 ç”¨æˆ·æµç¨‹æµ‹è¯•

```typescript
// __tests__/e2e/chat.spec.ts
import { test, expect, _electron as electron } from '@playwright/test';
import { ElectronApplication } from 'playwright';

test.describe('Chat Workflow', () => {
  let electronApp: ElectronApplication;

  test.beforeAll(async () => {
    electronApp = await electron.launch({
      args: ['dist/main.js']
    });
  });

  test.afterAll(async () => {
    await electronApp.close();
  });

  test('complete chat workflow', async () => {
    const window = await electronApp.firstWindow();

    // 1. ç­‰å¾…åº”ç”¨åŠ è½½
    await expect(window).toHaveTitle('è¶£çŸ¥æ¡Œé¢ç‰ˆ');

    // 2. å¯¼èˆªåˆ°çŸ¥è¯†é—®ç­”
    await window.click('[data-testid="nav-qna"]');
    await expect(window.locator('.chat-page')).toBeVisible();

    // 3. é€‰æ‹©åŠ©æ‰‹
    await window.click('[data-testid="assistant-list"]');
    await window.click('[data-testid="assistant-item"]:first-child');

    // 4. è¾“å…¥é—®é¢˜
    const input = window.locator('[data-testid="chat-input"]');
    await input.fill('ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ');

    // 5. å‘é€æ¶ˆæ¯
    await window.click('[data-testid="send-button"]');

    // 6. ç­‰å¾…å›å¤
    await expect(window.locator('[data-testid="message-assistant"]'))
      .toBeVisible({ timeout: 10000 });

    // 7. éªŒè¯å¯¹è¯å†å²
    const messages = window.locator('[data-testid^="message-"]');
    await expect(messages).toHaveCount(2); // ç”¨æˆ·æ¶ˆæ¯ + AIå›å¤
  });

  test('creates new assistant', async () => {
    const window = await electronApp.firstWindow();

    // å¯¼èˆªåˆ°çŸ¥è¯†é—®ç­”
    await window.click('[data-testid="nav-qna"]');

    // ç‚¹å‡»æ–°å»ºåŠ©æ‰‹
    await window.click('[data-testid="new-assistant"]');

    // å¡«å†™åŠ©æ‰‹ä¿¡æ¯
    await window.fill('[data-testid="assistant-name"]', 'æµ‹è¯•åŠ©æ‰‹');
    await window.fill('[data-testid="system-prompt"]', 'ä½ æ˜¯ä¸€ä¸ªhelpfulçš„åŠ©æ‰‹');

    // ä¿å­˜
    await window.click('[data-testid="save-assistant"]');

    // éªŒè¯åŠ©æ‰‹å·²åˆ›å»º
    await expect(window.locator('text=æµ‹è¯•åŠ©æ‰‹')).toBeVisible();
  });
});
```

### 5.2 è·¨å¹³å°æµ‹è¯•

```typescript
// __tests__/e2e/cross-platform.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Cross-Platform Compatibility', () => {
  test('works on macOS', async () => {
    test.skip(process.platform !== 'darwin', 'macOS only');
    
    // macOSç‰¹å®šæµ‹è¯•
  });

  test('works on Windows', async () => {
    test.skip(process.platform !== 'win32', 'Windows only');
    
    // Windowsç‰¹å®šæµ‹è¯•
  });

  test('works on Linux', async () => {
    test.skip(process.platform !== 'linux', 'Linux only');
    
    // Linuxç‰¹å®šæµ‹è¯•
  });
});
```

---

## 6. æ€§èƒ½æµ‹è¯•

### 6.1 å¯åŠ¨æ€§èƒ½æµ‹è¯•

```typescript
// __tests__/performance/startup.test.ts
import { _electron as electron } from '@playwright/test';

describe('Application Startup Performance', () => {
  test('åº”ç”¨å¯åŠ¨æ—¶é—´åº”å°äº3ç§’', async () => {
    const startTime = Date.now();

    const app = await electron.launch({
      args: ['dist/main.js']
    });

    const window = await app.firstWindow();
    await window.waitForLoadState('domcontentloaded');

    const endTime = Date.now();
    const startupTime = endTime - startTime;

    expect(startupTime).toBeLessThan(3000);

    await app.close();
  });
});
```

### 6.2 æ¸²æŸ“æ€§èƒ½æµ‹è¯•

```typescript
// __tests__/performance/rendering.test.ts
describe('Rendering Performance', () => {
  test('å¤§é‡æ¶ˆæ¯æ¸²æŸ“æ€§èƒ½', async () => {
    const { result } = renderHook(() => useChatContext());

    // ç”Ÿæˆ1000æ¡æ¶ˆæ¯
    const messages = Array.from({ length: 1000 }, (_, i) => ({
      id: `msg-${i}`,
      role: i % 2 === 0 ? 'user' : 'assistant',
      content: `æ¶ˆæ¯ ${i}`
    }));

    const startTime = performance.now();

    act(() => {
      messages.forEach(msg => result.current.addMessage(msg));
    });

    const endTime = performance.now();
    const renderTime = endTime - startTime;

    // 1000æ¡æ¶ˆæ¯æ¸²æŸ“æ—¶é—´åº”å°äº1ç§’
    expect(renderTime).toBeLessThan(1000);
  });
});
```

### 6.3 å†…å­˜æµ‹è¯•

```typescript
// __tests__/performance/memory.test.ts
describe('Memory Usage', () => {
  test('å†…å­˜ä½¿ç”¨ä¿æŒåˆç†èŒƒå›´', async () => {
    const app = await electron.launch({
      args: ['dist/main.js']
    });

    // æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œ
    const window = await app.firstWindow();
    
    // è·å–åˆå§‹å†…å­˜
    const initialMemory = await getMemoryUsage(app);

    // æ‰§è¡Œå¤§é‡æ“ä½œ
    for (let i = 0; i < 100; i++) {
      await window.click('[data-testid="new-document"]');
      await window.fill('[data-testid="document-content"]', 'content');
      await window.click('[data-testid="save-document"]');
    }

    // è·å–æœ€ç»ˆå†…å­˜
    const finalMemory = await getMemoryUsage(app);

    // å†…å­˜å¢é•¿åº”å°äº200MB
    const memoryIncrease = finalMemory - initialMemory;
    expect(memoryIncrease).toBeLessThan(200 * 1024 * 1024);

    await app.close();
  });
});
```

---

## 7. å¼€å‘å·¥å…·é“¾

### 7.1 ä»£ç è´¨é‡å·¥å…·

#### ESLinté…ç½®

```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'airbnb-typescript',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'prettier'
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    project: './tsconfig.json',
    ecmaVersion: 2020,
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true
    }
  },
  rules: {
    '@typescript-eslint/no-unused-vars': ['error', { 
      argsIgnorePattern: '^_' 
    }],
    'react/react-in-jsx-scope': 'off',
    'import/prefer-default-export': 'off',
    'no-console': ['warn', { allow: ['warn', 'error'] }]
  }
};
```

#### Prettieré…ç½®

```javascript
// .prettierrc.js
module.exports = {
  semi: true,
  trailingComma: 'es5',
  singleQuote: true,
  printWidth: 100,
  tabWidth: 2,
  useTabs: false,
  arrowParens: 'avoid',
  endOfLine: 'lf'
};
```

### 7.2 Git Hooks

```javascript
// .husky/pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¿è¡Œlint-staged
npx lint-staged

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check
```

```javascript
// .husky/pre-push
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¿è¡Œæµ‹è¯•
npm run test

# è¿è¡Œæ„å»ºæ£€æŸ¥
npm run build
```

```json
// package.json - lint-stagedé…ç½®
{
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yml}": [
      "prettier --write"
    ]
  }
}
```

### 7.3 CI/CDé…ç½®

```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [macos-latest, windows-latest, ubuntu-latest]
        node-version: [18.x]
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run linting
        run: npm run lint
      
      - name: Run type check
        run: npm run type-check
      
      - name: Run tests
        run: npm run test:coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/lcov.info
      
      - name: Build application
        run: npm run build
```

---

## 8. è´¨é‡ä¿éšœ

### 8.1 è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| ä»£ç è¦†ç›–ç‡ | > 80% | 75% | ğŸ”„ |
| æµ‹è¯•é€šè¿‡ç‡ | > 99% | 98% | ğŸ”„ |
| æ„å»ºæˆåŠŸç‡ | > 95% | 96% | âœ… |
| å¹³å‡ä¿®å¤æ—¶é—´ | < 24h | 18h | âœ… |
| Bugå¯†åº¦ | < 5ä¸ª/KLOC | 4ä¸ª/KLOC | âœ… |

### 8.2 æµ‹è¯•æŠ¥å‘Š

#### è¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open coverage/lcov-report/index.html
```

#### æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š

```bash
# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
npm run test -- --json --outputFile=test-results.json

# ç”ŸæˆHTMLæŠ¥å‘Š
npm run test -- --reporters=default --reporters=jest-html-reporter
```

### 8.3 æœ€ä½³å®è·µ

#### æµ‹è¯•å‘½åè§„èŒƒ

```typescript
// âœ… å¥½çš„å‘½å
describe('UserService', () => {
  describe('createUser', () => {
    test('creates user with valid data', () => {});
    test('throws error with invalid email', () => {});
    test('throws error with duplicate username', () => {});
  });
});

// âŒ ä¸å¥½çš„å‘½å
describe('test1', () => {
  test('should work', () => {});
});
```

#### æµ‹è¯•ç»„ç»‡åŸåˆ™

1. **AAAæ¨¡å¼**: Arrange(å‡†å¤‡) - Act(æ‰§è¡Œ) - Assert(æ–­è¨€)
2. **å•ä¸€èŒè´£**: æ¯ä¸ªæµ‹è¯•åªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½ç‚¹
3. **ç‹¬ç«‹æ€§**: æµ‹è¯•ä¹‹é—´ä¸åº”ç›¸äº’ä¾èµ–
4. **å¯é‡å¤æ€§**: æµ‹è¯•ç»“æœåº”è¯¥ç¨³å®šå¯é‡å¤
5. **å¿«é€Ÿæ‰§è¡Œ**: å•å…ƒæµ‹è¯•åº”è¯¥å¿«é€Ÿå®Œæˆ

---

## ğŸ“ æ€»ç»“

### ğŸ¯ æµ‹è¯•ç­–ç•¥æ ¸å¿ƒ

1. **é‡‘å­—å¡”åŸåˆ™**: 60%å•å…ƒæµ‹è¯• + 30%é›†æˆæµ‹è¯• + 10%E2Eæµ‹è¯•
2. **æŒç»­é›†æˆ**: æ¯æ¬¡æäº¤éƒ½è¿è¡Œæµ‹è¯•
3. **è´¨é‡é—¨ç¦**: æµ‹è¯•è¦†ç›–ç‡å’Œé€šè¿‡ç‡è¾¾æ ‡æ‰èƒ½åˆå¹¶
4. **æ€§èƒ½ç›‘æ§**: å®šæœŸè¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•

### ğŸ“ˆ è´¨é‡ä¿éšœæªæ–½

- è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„
- ä»£ç å®¡æŸ¥å’Œç»“å¯¹ç¼–ç¨‹
- æŒç»­é‡æ„å‡å°‘æŠ€æœ¯å€ºåŠ¡
- å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡

### ğŸ–ï¸ æˆåŠŸè¦ç´ 

- **å®Œå–„çš„æµ‹è¯•ä½“ç³»**: è¦†ç›–å•å…ƒã€é›†æˆã€E2Eå„å±‚æ¬¡
- **è‡ªåŠ¨åŒ–å·¥å…·é“¾**: CI/CDã€ä»£ç è´¨é‡å·¥å…·
- **è´¨é‡æ–‡åŒ–**: å›¢é˜Ÿé‡è§†æµ‹è¯•å’Œä»£ç è´¨é‡
- **æŒç»­æ”¹è¿›**: æ ¹æ®æŒ‡æ ‡ä¸æ–­ä¼˜åŒ–

é€šè¿‡å®Œå–„çš„æµ‹è¯•ç­–ç•¥å’Œè´¨é‡ä¿éšœä½“ç³»ï¼Œç¡®ä¿è¶£çŸ¥æ¡Œé¢ç‰ˆçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

---

*æœ¬æ–‡æ¡£å°†éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°å’Œå®Œå–„ã€‚*
*æœ€åæ›´æ–°: 2025-10-19*

