# 趣知桌面版 - 性能与无障碍

<div align="center">
  <h1>⚡ 性能与无障碍</h1>
  <p>优化性能与提升可访问性</p>
</div>

---

## 📖 目录

1. [性能优化](#1-性能优化)
2. [无障碍设计](#2-无障碍设计)
3. [最佳实践](#3-最佳实践)

---

## 1. 性能优化

### 1.1 CSS性能优化

#### 硬件加速

```css
/* 启用GPU加速 */
.accelerated {
  /* 告诉浏览器这些属性将会变化 */
  will-change: transform, opacity;
  
  /* 创建新的合成层 */
  transform: translateZ(0);
  
  /* 防止背面可见 */
  backface-visibility: hidden;
  
  /* 防止文字模糊 */
  -webkit-font-smoothing: antialiased;
}
```

#### 关键属性优化

```css
/* ✅ 推荐 - 使用transform和opacity */
.good-animation {
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.good-animation:hover {
  transform: translateY(-2px);
  opacity: 0.8;
}

/* ❌ 避免 - 会触发重排/重绘 */
.bad-animation {
  transition: width 0.3s ease, height 0.3s ease, top 0.3s ease;
}

.bad-animation:hover {
  width: 120%;
  height: 120%;
  top: -10px;
}
```

#### will-change使用

```css
/* 正确使用will-change */
.interactive-element {
  /* 在交互前设置 */
  will-change: transform;
}

.interactive-element:hover {
  transform: scale(1.1);
}

/* 动画结束后移除 */
.interactive-element.animation-done {
  will-change: auto;
}

/* ❌ 避免过度使用 */
.bad-usage {
  /* 不要在所有元素上都使用 */
  will-change: transform, opacity, color, background;
}
```

### 1.2 动画性能优化

#### 合成层优化

```css
/* 创建独立的合成层 */
.layer {
  /* 方法1: 使用transform 3D */
  transform: translate3d(0, 0, 0);
  
  /* 方法2: 使用translateZ */
  transform: translateZ(0);
  
  /* 方法3: 使用will-change */
  will-change: transform;
}
```

#### 避免布局抖动

```css
/* 使用transform代替position */
.position-animation {
  /* ❌ 避免 */
  /* transition: left 0.3s ease, top 0.3s ease; */
  
  /* ✅ 推荐 */
  transition: transform 0.3s ease;
}

/* 使用scale代替width/height */
.size-animation {
  /* ❌ 避免 */
  /* transition: width 0.3s ease, height 0.3s ease; */
  
  /* ✅ 推荐 */
  transition: transform 0.3s ease;
  transform-origin: center center;
}
```

#### 降低动画复杂度

```css
/* 简化阴影动画 */
.shadow-animation {
  /* 使用opacity控制阴影 */
  box-shadow: 0 8px 25px rgba(56, 178, 172, 0.2);
  transition: opacity 0.3s ease;
}

.shadow-animation::after {
  content: '';
  position: absolute;
  inset: 0;
  box-shadow: 0 12px 40px rgba(56, 178, 172, 0.4);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.shadow-animation:hover::after {
  opacity: 1;
}
```

### 1.3 毛玻璃效果优化

#### 性能考虑

```css
/* 毛玻璃效果 */
.glass-effect {
  background: rgba(26, 26, 46, 0.6);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* 移动端优化 - 简化效果 */
@media (max-width: 768px) {
  .glass-effect {
    /* 移动端可选择禁用模糊 */
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: rgba(26, 26, 46, 0.9);
  }
}

/* 降低动画要求设备的优化 */
@media (prefers-reduced-motion: reduce) {
  .glass-effect {
    backdrop-filter: none;
    background: rgba(26, 26, 46, 0.95);
  }
}
```

#### 限制模糊范围

```css
/* 限制模糊元素数量 */
.blur-container {
  /* 只在关键元素上使用 */
  backdrop-filter: blur(10px);
}

/* 避免嵌套多层模糊 */
.blur-container .nested {
  /* 子元素不再重复添加模糊 */
  backdrop-filter: none;
}
```

### 1.4 渲染优化

#### 减少重排重绘

```css
/* 批量样式更新 */
.batch-update {
  /* 使用transform和opacity */
  transform: translate(10px, 10px) scale(1.1);
  opacity: 0.8;
  /* 而不是分别设置left, top, width, height */
}

/* 避免强制同步布局 */
.avoid-layout-thrashing {
  /* 先读取后写入，避免交替读写 */
}
```

#### 虚拟滚动

```javascript
// 对于长列表使用虚拟滚动
// 只渲染可见区域的元素
const VirtualList = ({ items, itemHeight }) => {
  const [visibleRange, setVisibleRange] = useState({ start: 0, end: 20 });
  
  return (
    <div 
      style={{ height: items.length * itemHeight }}
      onScroll={handleScroll}
    >
      {items.slice(visibleRange.start, visibleRange.end).map(item => (
        <ListItem key={item.id} data={item} />
      ))}
    </div>
  );
};
```

### 1.5 资源加载优化

#### 延迟加载

```css
/* 图片延迟加载 */
.lazy-image {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.lazy-image.loaded {
  opacity: 1;
}
```

#### 字体优化

```css
/* 字体加载优化 */
@font-face {
  font-family: 'CustomFont';
  src: url('./fonts/custom.woff2') format('woff2');
  font-display: swap; /* 使用系统字体作为后备 */
}

/* 防止字体加载导致的布局抖动 */
body {
  font-family: -apple-system, sans-serif;
}

.font-loaded body {
  font-family: 'CustomFont', -apple-system, sans-serif;
}
```

---

## 2. 无障碍设计

### 2.1 键盘导航

#### 聚焦可见性

```css
/* 聚焦指示器 */
:focus {
  outline: 2px solid rgba(56, 178, 172, 0.5);
  outline-offset: 2px;
}

/* 仅键盘聚焦可见 */
:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}

/* 鼠标点击不显示outline */
:focus:not(:focus-visible) {
  outline: none;
}

/* 自定义聚焦样式 */
.custom-focus:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(56, 178, 172, 0.3);
}
```

#### Tab键顺序

```html
<!-- 使用tabindex控制焦点顺序 -->
<button tabindex="1">第一个</button>
<button tabindex="2">第二个</button>
<button tabindex="3">第三个</button>

<!-- tabindex="-1" 可通过JS聚焦，但不在tab顺序中 -->
<div tabindex="-1" id="dialog">对话框</div>

<!-- tabindex="0" 按DOM顺序 -->
<div tabindex="0">可聚焦的div</div>
```

#### 跳过导航

```html
<!-- 跳过导航链接 -->
<a href="#main-content" class="skip-link">
  跳到主要内容
</a>

<style>
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--primary-color);
  color: white;
  padding: 8px 16px;
  text-decoration: none;
  z-index: 100;
}

.skip-link:focus {
  top: 0;
}
</style>
```

### 2.2 颜色对比度

#### WCAG标准

```css
/* AA级别 (最低要求) */
/* 正文: 4.5:1 */
/* 大文本: 3:1 */

/* AAA级别 (增强) */
/* 正文: 7:1 */
/* 大文本: 4.5:1 */

/* 检查对比度 */
.good-contrast {
  /* ✅ 白色文字 on 深色背景 */
  color: #ffffff;           /* 白色 */
  background: #0f0f23;      /* 深色 */
  /* 对比度: 17.4:1 (AAA) */
}

.primary-contrast {
  /* ✅ 主色 on 深色背景 */
  color: #38b2ac;           /* 青绿色 */
  background: #0f0f23;      /* 深色 */
  /* 对比度: 7.8:1 (AAA) */
}

.bad-contrast {
  /* ❌ 对比度不足 */
  color: rgba(255, 255, 255, 0.3);
  background: rgba(26, 26, 46, 0.5);
  /* 对比度: < 3:1 (不达标) */
}
```

#### 不依赖颜色

```css
/* 不仅用颜色表示状态 */
.status-indicator {
  /* 使用图标 + 颜色 */
  display: flex;
  align-items: center;
  gap: 8px;
}

.status-success {
  color: var(--success);
}

.status-success::before {
  content: '✓';  /* 图标辅助 */
}

.status-error {
  color: var(--error);
}

.status-error::before {
  content: '✗';  /* 图标辅助 */
}
```

### 2.3 语义化HTML

#### 使用正确的标签

```html
<!-- ✅ 好的语义化 -->
<nav aria-label="主导航">
  <ul>
    <li><a href="/">首页</a></li>
    <li><a href="/about">关于</a></li>
  </ul>
</nav>

<main>
  <article>
    <h1>文章标题</h1>
    <p>文章内容...</p>
  </article>
</main>

<aside aria-label="侧边栏">
  <h2>相关链接</h2>
  <ul>...</ul>
</aside>

<!-- ❌ 避免全部使用div -->
<div class="nav">
  <div class="nav-item">...</div>
</div>
```

#### ARIA属性

```html
<!-- 可访问名称 -->
<button aria-label="关闭对话框">×</button>

<!-- 状态说明 -->
<button aria-expanded="false" aria-controls="menu">
  菜单
</button>

<!-- 当前状态 -->
<a href="/home" aria-current="page">首页</a>

<!-- 实时区域 -->
<div role="alert" aria-live="assertive">
  错误消息
</div>

<!-- 隐藏装饰性元素 -->
<span aria-hidden="true">→</span>
```

### 2.4 交互反馈

#### 视觉反馈

```css
/* 所有交互元素都有hover状态 */
.interactive:hover {
  background: rgba(56, 178, 172, 0.1);
  cursor: pointer;
}

/* 激活状态 */
.interactive:active {
  transform: scale(0.98);
}

/* 禁用状态清晰可见 */
.interactive:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
```

#### 屏幕阅读器文本

```html
<!-- 屏幕阅读器专用文本 -->
<button>
  <span aria-hidden="true">→</span>
  <span class="sr-only">下一页</span>
</button>

<style>
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
</style>
```

### 2.5 动画无障碍

#### 尊重用户偏好

```css
/* 减少动画偏好 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  /* 保留必要的淡入淡出 */
  .fade {
    transition: opacity 0.2s ease;
  }
  
  /* 禁用装饰性动画 */
  .decorative-animation {
    animation: none;
  }
}

/* 深色模式偏好 */
@media (prefers-color-scheme: dark) {
  :root {
    /* 已经是深色主题 */
  }
}

/* 高对比度模式 */
@media (prefers-contrast: high) {
  .card {
    border: 2px solid var(--text-primary);
  }
}
```

---

## 3. 最佳实践

### 3.1 性能检查清单

- [ ] 动画使用transform和opacity
- [ ] 关键动画使用will-change
- [ ] 避免嵌套多层毛玻璃效果
- [ ] 长列表使用虚拟滚动
- [ ] 图片使用延迟加载
- [ ] 字体使用font-display: swap
- [ ] 避免layout thrashing
- [ ] 移动端简化动画效果

### 3.2 无障碍检查清单

- [ ] 所有交互元素可键盘访问
- [ ] 聚焦状态清晰可见
- [ ] 颜色对比度达标(AA级以上)
- [ ] 不仅依赖颜色传达信息
- [ ] 使用语义化HTML
- [ ] 提供ARIA标签
- [ ] 支持屏幕阅读器
- [ ] 尊重用户动画偏好
- [ ] 提供跳过导航链接
- [ ] 表单标签正确关联

### 3.3 测试工具

#### 性能测试

```bash
# Chrome DevTools
# - Performance面板
# - Lighthouse
# - Coverage

# 命令行工具
npm run analyze  # webpack-bundle-analyzer
```

#### 无障碍测试

```bash
# 自动化工具
# - axe DevTools
# - WAVE
# - Lighthouse Accessibility

# 手动测试
# - 键盘导航测试
# - 屏幕阅读器测试 (NVDA, JAWS, VoiceOver)
# - 颜色对比度检查
```

### 3.4 性能指标

#### 关键指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| FCP | < 1.8s | 首次内容绘制 |
| LCP | < 2.5s | 最大内容绘制 |
| FID | < 100ms | 首次输入延迟 |
| CLS | < 0.1 | 累积布局偏移 |
| TTI | < 3.8s | 可交互时间 |

#### 动画性能

- 帧率: 保持60fps
- 动画时长: 通常0.2-0.5s
- 同时动画: 限制在5个以内

---

## 📝 总结

### 🎯 核心原则

1. **性能优先**: 使用高性能的动画属性
2. **用户至上**: 尊重用户的可访问性需求
3. **渐进增强**: 基础功能可用，增强体验
4. **测试验证**: 使用工具持续监测

### ⚡ 性能要点

- 优先使用transform和opacity
- 合理使用will-change
- 避免强制同步布局
- 移动端简化效果

### ♿ 无障碍要点

- 键盘可访问
- 高对比度
- 语义化HTML
- ARIA标签
- 屏幕阅读器支持

通过性能优化和无障碍设计，让应用既快速流畅，又人人可用。

---

*本文档定义了应用的性能和无障碍规范，确保高质量的用户体验。*
*最后更新: 2025-10-19*

